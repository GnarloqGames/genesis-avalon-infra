---
kind: pipeline
type: kubernetes
name: default

image_pull_secrets:
- harborcreds

steps:
- name: build-and-push-builder-image
  image: docker:dind
  when:
    branch:
      - main
  volumes:
  - name: dockersock
    path: /var/run
  commands:
  - sleep 5 # give docker enough time to start
  - echo ${DRONE_TAG}
  # - docker build -f ./docker/builder/Dockerfile registry.0x42.in/library/docker/genesis-avalon-builder:bookworm-${DRONE_TAG}

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}